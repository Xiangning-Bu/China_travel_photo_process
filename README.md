# 旅行证照片处理系统

一个旅行证照片处理工具，支持背景去除、照片裁剪和打印排版。

## 功能特点

- **背景去除**: 多种算法支持
  - Rembg库（效果最佳，推荐）
  - 在线Remove.bg API（需要API密钥）
- **照片裁剪**: 自动/手动裁剪旅行证照片，符合标准尺寸
  - 手动调整界面支持缩放和平移，方便精确定位
  - 实时显示参考距离，确保符合旅行证照片标准
- **照片排版**: 将旅行证照片排版成适合打印的版式
- **多格式支持**: 保存为PNG、JPEG、TIFF、BMP、WebP和PDF格式

## 安装指南

1. 克隆或下载本项目
2. 安装Python 3.8+
3. 创建并激活虚拟环境:

```bash
python -m venv .venv
.\.venv\Scripts\activate  # Windows
source .venv/bin/activate  # Linux/MacOS
```

4. 安装依赖库:

```bash
python -m pip install -r requirements.txt
```

## 使用说明

### 启动程序

```bash
python main.py
```

### 背景去除

1. 在"背景去除"选项卡中，点击"上传照片"选择要处理的照片
2. 选择背景去除方法:
   - Rembg: 效果最佳，内部使用U2Net模型，会自动下载
   - 在线API: 需要API密钥(从[Remove.bg](https://www.remove.bg)获取)
3. 点击"去除背景"按钮
4. 处理完成后，点击"保存图片"按钮保存结果

### 照片裁剪

1. 在"照片裁剪"选项卡中，点击"上传照片"
2. 选择"自动裁剪"或"手动调整"
   - 自动裁剪: 系统会自动检测面部并裁剪
   - 手动调整: 可以拖动黄色控制点调整位置，使用滑块调整大小
     - 使用鼠标滚轮或缩放按钮放大/缩小图像
     - 按住鼠标中键拖动可平移视图
     - 拖动黄色圆点调整面部位置，椭圆会随之移动
     - 黄色边框内区域为最终裁剪区域，边框外区域会变暗并被裁剪掉
     - 红色数字显示红色椭圆边缘到裁剪框的实际距离(mm)
     - 使用滑块调整面部大小
3. 点击"保存照片"按钮保存结果

### 照片排版

1. 在"照片排版"选项卡中，点击"上传照片"
2. 点击"生成排版"按钮
3. 点击"保存打印文件"按钮，选择格式(包括PDF)保存结果

## 使用高级功能

### Rembg深度学习模型

rembg库在首次使用时会自动下载所需的模型文件。下载过程会在后台自动进行，无需手动干预。如果您在首次使用时网络连接不佳，可能需要等待较长时间。

### Remove.bg API

要使用Remove.bg API:

1. 注册[Remove.bg](https://www.remove.bg)账号并获取API密钥
2. 在程序中点击"设置API密钥"按钮
3. 输入API密钥后确认

## 旅行证照片标准

本程序支持的标准旅行证照片规格:

- 尺寸: 33mm × 48mm
- 头部高度: 28mm - 33mm (占照片58% - 69%)
- 头顶到照片顶部: 3mm - 5mm
- 眼睛到照片底部: 15mm - 22mm

## 故障排除

- **问题**: 程序启动时报错
  **解决方案**: 确保正确安装了所有依赖项

- **问题**: 背景去除过程中程序卡住
  **解决方案**: 尝试使用更小的图片或切换到不同的背景去除方法

- **问题**: 无法检测到人脸
  **解决方案**: 确保照片中人脸清晰可见，光线充足，或尝试使用手动调整功能

- **问题**: 手动调整时照片看不全
  **解决方案**: 使用放大/缩小按钮或鼠标滚轮调整视图，按住鼠标中键可拖动画面

## 注意事项

- 大尺寸图片处理可能较慢
- U2Net模型需要约500MB存储空间
- Remove.bg API每月有免费使用次数限制

## 许可证

本项目采用MIT许可证 
